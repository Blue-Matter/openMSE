---
date: "2021-03-23T15:18:01+06:00"
title: The Anatomy of an MP
weight: 4
---
 
```{r, include=FALSE}
library(openMSE)
```
In this section we dive into the contents of MP functions in more detail.

Let's examine an existing output MP to identify the MP data requirements. 

Since we've seen it used as a default MP in other examples, let's learn more about how `DCAC` function in the `DLMtool` package. Type `?DCAC` in the R console or visit the [DCAC MP documentation page](https://dlmtool.openmse.com/reference/DCAC.html) for details on the DCAC MP.

We can see the code for the `DCAC` MP by simply typing the name of the MP into the console (this is a fantastic advantage of using R - there is complete transparency about package functions):

```{r}
DCAC
```

There are several versions of the `DCAC` MP in the `DLMtool` package (this version updates the estimated depletion in the projection period). We can see that `DCAC` is a wrapper for the internal `DCAC_` function.

Let's print out the contents of the `DCAC_` function:

```{r}
DCAC_
```

"Crikey that looks complicated!" might be your first reaction. However this output MP function is easily demystified.  

Like all MPs it has four main arguments: `x`, `Data`, `reps` and `plot` (the last argument is optional), plus, because this function is accessed via a wrapper, a few that are specific to this MP.

The argument `x` is the position in the [Data object](/object-data/). When real data are stored in a Data object, there is only one position - there is only one real data set. 

However, in MSE we conduct many simulations and x refers to simulated data from simulation number `x`. Any single parameters such as natural mortality rate (`Mort`) are a vector (`nsim` long). See `Data@Mort[x]` in the DCAC code. Any time series such as annual catches or relative abundance indices, are a matrix of `nsim` rows and `nyears` columns.

A range of [example objects](/object-data/example/) of class Data are available:

```{r}
avail('Data')
```

For simplicity lets use a Data object with just two simulations, `SimulatedData` and rename it `Data`

```{r}
Data <-  SimulatedData
```

Since there are only three simulations in this data set (3 positions) we can now see three values of natural mortality rate:
```{r}
Data@Mort
```

And a matrix of catches with three rows:
```{r}
Data@Cat
```

We could generate a single TAC recommendation from these data using DCAC by specifying position 1 (for the first simulation) and by setting reps=1 (we want a single DCAC TAC recommendation)

```{r}
DCAC(x=1,Data,reps=1)
```

If we wanted a stochastic estimate of the TAC we could increase the number of reps:

```{r}
hist(DCAC(x=1,Data,reps=1000)@TAC,xlab="TAC",ylab="Freq.",col="blue")
```

In the next section we describe how to build custom MPs.
