---
date: "2021-02-10T11:35:01+06:00"
title: Case study
weight: 3
---



<div id="pacific-cod-example" class="section level3">
<h3>Pacific cod example</h3>
<p>In British Columbia, Canada, Pacific cod was assessed in 2018 with an update in 2020 (<a href="https://www.dfo-mpo.gc.ca/csas-sccs/Publications/ResDocs-DocRech/2020/2020_070-eng.html">Forrest et al. 2020</a>, <a href="https://www.dfo-mpo.gc.ca/csas-sccs/Publications/ScR-RS/2021/2021_002-eng.html">DFO 2021</a>). Here, data for Area 5ABCD (Hecate Strait and Queen Charlotte Sound) was used to condition operating models, which mimicked the configuration of the delay difference assessments.</p>
</div>
<div id="function-call-setup" class="section level3">
<h3>Function call setup</h3>
<p>The data and preliminary operating model for Pacific cod 5ABCD is available in SAMtool:</p>
<pre class="r"><code>library(SAMtool)
data(pcod)</code></pre>
<p>The base assessment had the following data and features:</p>
<ul>
<li>Single fishing fleet with catch (<code>pcod$data@Chist</code>) and mean weight series (<code>pcod$data@MS</code>)</li>
<li>Five indices of abundance (<code>pcod$data@Index</code>)</li>
<li>Maturity and selectivity are knife-edge at age-two</li>
<li>Priors were set for several indices of abundance to inform stock size in the model</li>
<li>Priors were also set for stock-recruit steepness and natural mortality</li>
<li>Initial depletion entering the first year of the model (1956) was estimated as a deviation from equilibrium unfished recruitment</li>
</ul>
<p>A function call of the conditioning model that incorporates these features looks like this:</p>
<pre class="r"><code>mat_ogive &lt;- ifelse(0:pcod$OM@maxage &lt; 2, 0, 1)
out &lt;- RCM(OM = pcod$OM, data = pcod$data, 
           condition = &quot;catch&quot;, mean_fit = TRUE,
           selectivity = &quot;free&quot;, s_selectivity = rep(&quot;SSB&quot;, ncol(pcod$data@Index)),
           start = list(vul_par = matrix(mat_ogive, length(mat_ogive), 1)),
           map = list(vul_par = matrix(NA, length(mat_ogive), 1),
                      log_early_rec_dev = rep(1, pcod$OM@maxage)),
           prior = pcod$prior)</code></pre>
<div id="operating-model" class="section level4">
<h4>Operating model</h4>
<p>The preliminary operating model (<code>pcod$OM</code>) contains biological parameters for growth, maturity, natural mortality, steepness, recruitment variability that will be used to inform the conditioning model.</p>
<p>The operating models were set up with values of steepness <code>pcod$OM@cpars$h</code> and M <code>pcod$OM@cpars$M</code> sampled from their respective distributions, the means and standard deviations of which were informed by the posterior of the delay difference assessment.</p>
<p><img src="/tutorial-rcm/3-case-study/_index.en_files/figure-html/unnamed-chunk-4-1.png" width="672" />
<img src="/tutorial-rcm/3-case-study/_index.en_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="selectivity" class="section level4">
<h4>Selectivity</h4>
<p>See the article on setup of fleet and index selectivity <a href="https://openmse.com/tutorial-rcm-select/">here</a>.</p>
<p>Knife-edge selectivity is set up by setting <code>selectivity = "free"</code> and providing the selectivity-at-age matrix in the <code>vul_par</code> argument. Since selectivity is fixed and not estimated, the <code>map_vul_par</code> argument is also provided (a matrix of <code>NA</code>).</p>
<p>Index selectivity is informed by the knife-edge maturity in the OM, so argument <code>s_selectivity</code> is set to <code>"SSB"</code> for all 5 indices.</p>
</div>
<div id="initial-depletion" class="section level4">
<h4>Initial depletion</h4>
<p>By default, the RCM generates an unfished population in the first year of the model, but we can estimate a deviation from unfished recruitment as a deviation from equilibrium unfished recruitment. A deviation <code>log_early_rec_dev</code> exists for each age cohort (of age-1 and older) in the first year of the model. To set them up as a single estimated parameter, we set the map argument to one for all these parameters <code>map_log_early_rec_dev = rep(1, OM@maxage)</code> (the map argument indicates to TMB whether parameter values are shared together or fixed to starting values).</p>
</div>
<div id="priors-on-catchability" class="section level4">
<h4>Priors on catchability</h4>
<p>Priors on index q can be set through <code>pcod$prior &lt;- list(q = ...)</code> for two of the five indices, following the assessment:</p>
<pre class="r"><code>pcod$prior$q</code></pre>
<pre><code>##                   Mean  SD
## HSMSAS              NA  NA
## SYN QCS     0.40820819 0.3
## SYN HS      0.06548742 0.3
## CPUE Hist           NA  NA
## CPUE Modern         NA  NA</code></pre>
</div>
<div id="results" class="section level4">
<h4>Results</h4>
<p>Model fits and estimated parameters can be found in the markdown reports:</p>
<pre class="r"><code>plot(out)</code></pre>
<p>Since we sampled steepness and natural mortality from a distribution, a range of historical SSB values is reconstructed:</p>
<p><img src="/tutorial-rcm/3-case-study/_index.en_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>When conditioned on catch, a range for fishing mortality is similarly produced:
<img src="/tutorial-rcm/3-case-study/_index.en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>For all simulations, the SSB in 2020 is below the upper stock reference (USR), the mean SSB estimated during 1956-2004:</p>
<p><img src="/tutorial-rcm/3-case-study/_index.en_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>These figures are comparable to Figures 19, 20, and 22 of <a href="https://www.dfo-mpo.gc.ca/csas-sccs/Publications/ResDocs-DocRech/2020/2020_070-eng.html">Forrest et al. 2020</a>.</p>
<p>Finally, RCM also generates an updated OM that is ready for closed-loop simulation, where the historical period is conditioned by the estimation model:</p>
<pre class="r"><code>MSE &lt;- MSEtool::runMSE(out@OM, ...)</code></pre>
</div>
</div>
<div id="alternative-operating-models" class="section level3">
<h3>Alternative operating models</h3>
<p>An alternative scenario can be generated where knife-edge maturity and selectivity is age-3 instead of age-2. The following code that updates the maturity and fishery/index selectivity in the OM and RCM:</p>
<pre class="r"><code>out_age3 &lt;- local({
  pcod$OM@cpars$Mat_age[, 3, ] &lt;- 0
  mat_ogive_age3 &lt;- pcod$OM@cpars$Mat_age[1, , 1]
  RCM(OM = pcod$OM, data = pcod$data, 
      condition = &quot;catch&quot;, mean_fit = TRUE,
      selectivity = &quot;free&quot;, s_selectivity = rep(&quot;SSB&quot;, ncol(pcod$data@Index)),
      start = list(vul_par = matrix(mat_ogive_age3, length(mat_ogive_age3), 1)),
      map = list(vul_par = matrix(NA, length(mat_ogive_age3), 1),   
                 log_early_rec_dev = rep(1, pcod$OM@maxage)),
      prior = pcod$prior)
})</code></pre>
</div>
<div id="comparing-multiple-model-fits" class="section level3">
<h3>Comparing multiple model fits</h3>
<p>From multiple OM scenarios and corresponding RCM fits, the <code>compare_RCM</code> function allows users to compare RCM fits, estimated parameters, and likelihood values.</p>
<pre class="r"><code>compare_RCM(out, out_age3, 
            scenario = list(names = c(&quot;Age-2 maturity&quot;, &quot;Age-3 maturity&quot;)),
            s_name = colnames(pcod$data@Index))</code></pre>
<p>The comparison primarily uses the mean scenarios from each OM:</p>
<p><img src="/tutorial-rcm/3-case-study/_index.en_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
